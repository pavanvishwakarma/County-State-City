<!DOCTYPE html>
<html lang="en">
   <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
   <head>
      <title>Country/State/City</title>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="icon" type="image/png" href="images/icons/favicon.ico" />
      <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
      <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
      <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
      <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
      <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
      <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
      <link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
      <link rel="stylesheet" type="text/css" href="vendor/noui/nouislider.min.css">
      <link rel="stylesheet" type="text/css" href="css/util.css">
      <link rel="stylesheet" type="text/css" href="css/main.css">
      <style type="text/css">
         span.error {
             color: red;
             position: absolute;
             top: 52%;
             right: 10px;
             font-family: 'Montserrat-SemiBold';
             font-size: 14px;
         }
            .wrap-contact100{
               width: 40%;
               padding: 30px 30px 30px;
            }
            .container-contact100 {
                align-items: flex-start;
            }
            table {
                border: 1px #a39485 solid;
                font-size: 1em;
                box-shadow: 0 2px 5px rgba(0,0,0,.25);
                width: 58%;
                border-collapse: collapse;
                border-radius: 5px;
                overflow: hidden;
                margin-left: 35px;
                font-family: 'Montserrat-SemiBold';
                font-weight: 300;
            }

            th {
              text-align: left;
            }
              
            thead {
              font-weight: bold;
              color: #fff;
              background: #73685d;
            }
              
            td, th {
              padding: 1em 1em;
              vertical-align: middle;
            }
              
            td {
              border-bottom: 1px solid rgba(0,0,0,.1);
              background: #fff;
            }

            a {
              color: #73685d;
            }
              
            @media all and (max-width: 768px) {
                
              table, thead, tbody, th, td, tr {
                display: block;
              }
              
              th {
                text-align: right;
              }
              
              table {
                position: relative; 
                padding-bottom: 0;
                border: none;
                box-shadow: 0 0 10px rgba(0,0,0,.2);
              }
              
              thead {
                float: left;
                white-space: nowrap;
              }
              
              tbody {
                overflow-x: auto;
                overflow-y: hidden;
                position: relative;
                white-space: nowrap;
              }
              
              tr {
                display: inline-block;
                vertical-align: top;
              }
              
              th {
                border-bottom: 1px solid #a39485;
              }
              
              td {
                border-bottom: 1px solid #e5e5e5;
              }
              
           }
      </style>
   </head>
   <body>
<span id="lblError" style="color: red"></span>
      <div class="container-contact100">
         <div class="wrap-contact100">
            <form class="contact100-form validate-form" id="myForm">
               <span class="contact100-form-title">Country/State/City</span>

               <div class="wrap-input100 validate-input bg1" data-validate="Please Type Your Name">
                  <span class="label-input100">FULL NAME *</span>
                  <input class="input100" type="text" name="name" id="name" placeholder="Enter Your Name" >
                  <span class="error" id="nameErr"></span>
               </div>

               <div class="wrap-input100 validate-input bg1 rs1-wrap-input100" data-validate="Enter Your Email (e@a.x)" >
                  <span class="label-input100">Email *</span>
                  <input class="input100" type="text" name="email" id="email" placeholder="Enter Your Email " >
                  <span class="error" id="emailErr"></span>
               </div>

               <div class="wrap-input100 validate-input bg1 rs1-wrap-input100" data-validate="Enter Your Phone">
                  <span class="label-input100">Phone</span>
                  <input class="input100" type="number" name="phone" id="phone" placeholder="Enter Number Phone" >
                  <span class="error" id="phoneErr"></span>
               </div>

               <div class="wrap-input100 validate-input input100-select bg1" >
                  <span class="label-input100">Country *</span>
                  <span class="error" id="countryErr"></span>
                  <div data-validate="Select Your Country">
                     <select class="js-select2 input100" name="country" id="country" onchange="getState(this.value);return false;">
                        <option value='0'>Select Country</option>
                     </select>
                     
                     <div class="dropDownSelect2"></div>
                  </div>
               </div>

               <div class="wrap-input100 validate-input input100-select bg1">
                  <span class="label-input100">State *</span>
                  <span class="error" id="stateErr"></span>
                  <div>
                     <select class="js-select2 input100" name="state" id="state" onchange="getCities(this);return false;">
                        <option value='0'>Select State</option>
                     </select>
                     <div class="dropDownSelect2"></div>
                  </div>
               </div>

               <div class="wrap-input100 validate-input input100-select bg1">
                  <span class="label-input100">City *</span>
                  <span class="error" id="cityErr"></span>
                  <div>
                     <select class="js-select2 input100" name="cities" id="cities" >
                        <option value='0'>Select City</option>
                     </select>
                     <div class="dropDownSelect2"></div>
                  </div>
               </div>

               <div class="wrap-input100 validate-input bg0 rs1-alert-validate" data-validate="Please Type Your Message">
                  <span class="label-input100">Message</span>
                  <textarea class="input100" name="message" placeholder="Your message here..."></textarea>
               </div>

               <div class="container-contact100-form-btn">
                  <button class="contact100-form-btn" type="Submit">
                     <span>Submit<i class="fa fa-long-arrow-right m-l-7" aria-hidden="true"></i></span>
                  </button>
               </div>
               
            </form>
         </div>
         <table>
             <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Country</th>
                    <th>State</th>
                    <th>City</th>
                </tr>
             </thead>
             <tbody id="table">
             </tbody>
         </table>
      </div>
      <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
      <script src="vendor/animsition/js/animsition.min.js"></script>
      <script src="vendor/bootstrap/js/popper.js"></script>
      <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
      <script src="vendor/select2/select2.min.js"></script>
      <script>
         $(".js-select2").each(function(){
         	$(this).select2({
         		minimumResultsForSearch: 20,
         		dropdownParent: $(this).next('.dropDownSelect2')
         	});
         })
      </script>
      <script src="vendor/daterangepicker/moment.min.js"></script>
      <script src="vendor/daterangepicker/daterangepicker.js"></script>
      <script src="vendor/countdowntime/countdowntime.js"></script>
      <!-- <script src="js/main.js"></script> -->
      <script type="text/javascript">
      async	function loadCountries(){
         
      	const options = {
      		method: 'GET',
      		headers: {
      			'X-CSCAPI-KEY': 'WVBOZ0tVajRLMElWcG55YlJPb3lTbFBNdjFvakpXRzVVV0hJeTZ2UQ=='
      		},
      		redirect: 'follow'
      	};
      		const response = await fetch('https://api.countrystatecity.in/v1/countries', options);
      		const countries  = await response.json();
      		return countries;
      }
      document.addEventListener("DOMContentLoaded", async () => {
      	let countries = [];
      	try {
      	 	countries = await loadCountries();
      	}catch (e) {
      	 	console.log("Error!")
      	 	console.log(e)
      	}
            var dd = '';
            dd+= "<option value='0'>Select Country</option>"
            for (i = 0; i < countries.length; i++) {
         	    dd += "<option value='"+countries[i].iso2+"'>"+countries[i].name+"</option>";
         	}
         	document.getElementById("country").innerHTML = dd;
      });


      // States
      async function getState(country){
            // var countryVal = document.getElementById("country").value;
            // var lblError = document.getElementById("countryErr");
            // lblError.innerHTML = "";
            // if (countryVal == 0 ) {
            //    lblError.innerHTML = "Please Select Country.";
            //    return false;
            // }
      		const options = {
      			method: 'GET',
      			headers: {
      				'X-CSCAPI-KEY': 'WVBOZ0tVajRLMElWcG55YlJPb3lTbFBNdjFvakpXRzVVV0hJeTZ2UQ=='
      			},
      			redirect: 'follow'
      		};
      		const response = await fetch('https://api.countrystatecity.in/v1/countries/'+country+'/states', options);
      		const states  = await response.json();
            if (country) {
               document.getElementById("cities").innerHTML = '<option value="0">Select City</option>';
            }
      		var ss = '';
      		ss+= "<option value='0'>Select State</option>"
      	  for (i = 0; i < states.length; i++) {
      		    ss += "<option value='"+states[i].iso2+"' data-country='"+country+"'>"+states[i].name+"</option>";
      		}
      		// console.log(states);
      		document.getElementById("state").innerHTML = ss;
      }

      	// Cities
      	async function getCities(event){
            // var stateVal = document.getElementById("state").value;
            // var lblError = document.getElementById("stateErr");
            // lblError.innerHTML = "";
            // if (stateVal == 0 ) {
            //    lblError.innerHTML = "Please Select State.";
            //    return false;
            // }
            var opt = event.options[event.selectedIndex];
            var country = opt.dataset.country;
            var state = event.value;
      		const options = {
      			method: 'GET',
      			headers: {
      				'X-CSCAPI-KEY': 'WVBOZ0tVajRLMElWcG55YlJPb3lTbFBNdjFvakpXRzVVV0hJeTZ2UQ=='
      			},
      			redirect: 'follow'
      		};
      		const response = await fetch('https://api.countrystatecity.in/v1/countries/'+country+'/states/'+state+'/cities', options);
      		const cities  = await response.json();
      		var cc = '';
      		cc+= "<option value='0'>Select City</option>"
      	  for (i = 0; i < cities.length; i++) {
      		    cc += "<option value='"+cities[i].name+"'>"+cities[i].name+"</option>";
      		}
      		document.getElementById("cities").innerHTML = cc;
         }
      </script>


      

      <script type="text/javascript">
         const getData = JSON.parse(localStorage.getItem('myFormData'));
         let output = '';
         for (i = 0; i < getData.length; i++) {
             output += "<tr>";
             output += "<td>"+ getData[i].name+"</td>";
             output += "<td>"+ getData[i].email+"</td>";
             output += "<td>"+ getData[i].country+"</td>";
             output += "<td>"+ getData[i].state+"</td>";
             output += "<td>"+ getData[i].cities+"</td>";
             output += "</tr>";
         }
         document.getElementById("table").innerHTML = output;
      </script>


      <script>
      myForm.onsubmit = (e) => {
         e.preventDefault();

         
         // var x = document.getElementById("name");
         
         var name = document.getElementById("name");
         name.value = name.value.toUpperCase();
         var nameErr = document.getElementById("nameErr");
         nameErr.innerHTML = "";
         if (name.value.trim()==='' ) {
            nameErr.innerHTML = "Please Enter Name.";
            name.focus();
            return false;
         }

         var email = document.getElementById("email").value;
         var emailErr = document.getElementById("emailErr");
         emailErr.innerHTML = "";
         var expr = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
         if (!expr.test(email)) {
            emailErr.innerHTML = "Enter Your Email (e@a.x)";
            return false;
         }

         var phone = document.getElementById("phone").value;
         var phoneErr = document.getElementById("phoneErr");
         phoneErr.innerHTML = "";
         if (phone.trim()==='' ) {
            phoneErr.innerHTML = "Please Enter Phone.";
            return false;
         }

         var countryVal = document.getElementById("country").value;
         var countryErr = document.getElementById("countryErr");
         countryErr.innerHTML = "";
         if (countryVal == 0 ) {
            countryErr.innerHTML = "Please Select Country.";
            return false;
         }

         var stateVal = document.getElementById("state").value;
         var stateErr = document.getElementById("stateErr");
         stateErr.innerHTML = "";
         if (stateVal == 0 ) {
            stateErr.innerHTML = "Please Select State.";
            return false;
         }

         var cities = document.getElementById("cities").value;
         var cityErr = document.getElementById("cityErr");
         cityErr.innerHTML = "";
         if (cities == 0) {
            cityErr.innerHTML = "Please Select City.";
            return false;
         }



         let formData = new FormData(myForm)

         fetch("https://script.google.com/macros/s/AKfycbwKkk0IxRjYhWzFtM0horvCBxmYIjGZaxnpx0XoAxRZp7xiTz2viqj_auEas9HGt6MW5w/exec", {
             method: 'post',
             body: formData,
         }).then((response) => {
             return response.json()
         }).then((res) => {
             if (res.result == 'success') {
                 console.log("Successfully created!")
             }
         }).catch((error) => {
             console.log(error)
         })


         let fdata = [];
         
         var formObj = {};
         for(var pair of formData.entries()) {
            formObj[pair[0]] = pair[1];
         }
         fdata = JSON.parse(localStorage.getItem('myFormData')) || [];
         fdata.push(formObj);
         localStorage.setItem('myFormData', JSON.stringify(fdata));

         const getData = JSON.parse(localStorage.getItem('myFormData'));
         let output = '';
         for (i = 0; i < getData.length; i++) {
             output += "<tr>";
             output += "<td>"+ getData[i].name+"</td>";
             output += "<td>"+ getData[i].email+"</td>";
             output += "<td>"+ getData[i].country+"</td>";
             output += "<td>"+ getData[i].state+"</td>";
             output += "<td>"+ getData[i].cities+"</td>";
             output += "</tr>";
         }
         document.getElementById("table").innerHTML = output;
         myForm.reset();
         myForm.country.innerHTML = '<option value="0">Select Country</option>';
         myForm.state.innerHTML = '<option value="0">Select State</option>';
         myForm.cities.innerHTML = '<option value="0">Select City</option>';
      };
      </script>

   </body>
</html>